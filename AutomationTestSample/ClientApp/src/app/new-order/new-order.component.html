<h1 id="tableLabel">New Order</h1>

<form [formGroup]="orderForm" (ngSubmit)="onSubmit()">

  <div class="container">

    <div class="row">
      <div class="col">
        
        <h2>Patient Information</h2>

        <div class="form-group row">
          <label for="mrn" class="col-sm-4 col-form-label">MRN: </label>
          <div class="col-sm-8">
            <input id="mrn" type="text" class="form-control" formControlName="patientMrn">
            <div *ngIf="orderForm.controls['patientMrn'].invalid && (orderForm.controls['patientMrn'].dirty || orderForm.controls['patientMrn'].touched)" class="text-danger">
              <div *ngIf="orderForm.controls['patientMrn'].errors?.required">
                MRN is required.
              </div>
              <div *ngIf="orderForm.controls['patientMrn'].errors?.maxlength">
                Maximum length is 16 characters.
              </div>
            </div>
          </div>
        </div>

        <div class="form-group row">
          <label for="first-name" class="col-sm-4 col-form-label">First Name: </label>
          <div class="col-sm-8">
            <input id="first-name" type="text" class="form-control" formControlName="patientFirstName">
            <div *ngIf="orderForm.controls['patientFirstName'].invalid && (orderForm.controls['patientFirstName'].dirty || orderForm.controls['patientFirstName'].touched)" class="text-danger">
              <div *ngIf="orderForm.controls['patientFirstName'].errors?.required">
                First Name is required.
              </div>
              <div *ngIf="orderForm.controls['patientFirstName'].errors?.maxlength">
                Maximum length is 64 characters.
              </div>
            </div>
          </div>
        </div>

        <div class="form-group row">
          <label for="last-name" class="col-sm-4 col-form-label">Last Name: </label>
          <div class="col-sm-8">
            <input id="last-name" type="text" class="form-control" formControlName="patientLastName">
            <div *ngIf="orderForm.controls['patientLastName'].invalid && (orderForm.controls['patientLastName'].dirty || orderForm.controls['patientLastName'].touched)" class="text-danger">
              <div *ngIf="orderForm.controls['patientLastName'].errors?.required">
                Last Name is required.
              </div>
              <div *ngIf="orderForm.controls['patientLastName'].errors?.maxlength">
                Maximum length is 64 characters.
              </div>
            </div>

          </div>
        </div>
          
        
      </div>
      <div class="col">
        <h2>Study Details</h2>

        <div class="form-group row">
          <label for="accession-number" class="col-sm-4 col-form-label">Accession Number: </label>
          <div class="col-sm-8">
            <input id="accession-number" type="text" class="form-control" formControlName="accessionNumber">
            <div *ngIf="orderForm.controls['accessionNumber'].invalid && (orderForm.controls['accessionNumber'].dirty || orderForm.controls['accessionNumber'].touched)" class="text-danger">
              <div *ngIf="orderForm.controls['accessionNumber'].errors?.required">
                Accession Number is required.
              </div>
              <div *ngIf="orderForm.controls['accessionNumber'].errors?.maxlength">
                Maximum length is 64 characters.
              </div>
            </div>
          </div>
        </div>

        <div class="form-group row">
          <label for="org-code" class="col-sm-4 col-form-label">Organisation: </label>
          <div class="col-sm-8">
            <select #orgCode id="org-code" class="form-control custom-select" formControlName="orgCode" (change)="onOrgChange(orgCode.value)">
              <option *ngFor="let client of clients" [value]="client.orgCode">
                {{ client.name }} ({{ client.orgCode }})
              </option>
            </select>
            <div *ngIf="orderForm.controls['orgCode'].invalid && (orderForm.controls['orgCode'].dirty || orderForm.controls['orgCode'].touched)" class="text-danger">
              <div *ngIf="orderForm.controls['orgCode'].errors?.required">
                Organisation is required.
              </div>
            </div>
          </div>
        </div>

        <div class="form-group row">
          <label for="site-id" class="col-sm-4 col-form-label">Site Id: </label>
          <div class="col-sm-8">
            <select id="site-id" class="form-control custom-select" formControlName="siteId" required>
              <option *ngFor="let site of sites" [value]="site.id">
                {{ site.name }}
              </option>
            </select>
            <div *ngIf="orderForm.controls['siteId'].invalid && (orderForm.controls['siteId'].dirty || orderForm.controls['siteId'].touched)" class="text-danger">
              <div *ngIf="orderForm.controls['siteId'].errors?.required">
                Site is required.
              </div>
            </div>
          </div>
        </div>

        <div class="form-group row">
          <label for="modality" class="col-sm-4 col-form-label">Modality: </label>
          <div class="col-sm-8">
            <select id="modality" class="form-control custom-select" formControlName="modality">
              <option *ngFor="let modality of modalities" [value]="modality.code">
                {{ modality.name }} ({{ modality.code }})
              </option>
            </select>
          </div>
        </div>

        <div class="form-group row">
          <label for="study-date-time" class="col-sm-4 col-form-label">Study DateTime: </label>
          <div class="col-sm-8">
            <input id="study-date-time" type="datetime-local" class="form-control" formControlName="studyDateTime">
            <div *ngIf="orderForm.controls['studyDateTime'].invalid && (orderForm.controls['studyDateTime'].dirty || orderForm.controls['studyDateTime'].touched)" class="text-danger">
              <div *ngIf="orderForm.controls['studyDateTime'].errors?.required">
                Study DateTime is required.
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="row">
      <div class="col-sm">
        <button type="submit" class="btn btn-primary mr-1">Submit</button>&nbsp;
        <button type="button" class="btn btn-warning" [routerLink]="['/orders']">Cancel</button>
      </div>
    </div>

    <div id="message-container" class="row">
      <div *ngIf="errorMessage" class="text-danger">
        {{ errorMessage }}
      </div>
    </div>

  </div>

</form>
